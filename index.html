<html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<link rel="stylesheet" href="styles.css">

<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
 
//helper function that parse the url
function getJsonFromUrl() {
  var query = location.search.substr(1);
  var result = {};
  query.split("&").forEach(function(part) {
    var item = part.split("=");
    result[item[0]] = decodeURIComponent(item[1]);
  });
  return result;
}
    
$(document).ready(function(){
    params = getJsonFromUrl();
    
    // Get the dish info
    $.get("http://192.17.90.133:8081",{request_type:'find_dish', name:params['name'], RIN:params['RIN']}, function(data){
        dish = data[0]
        console.log(dish);
        $("#dish_name").text(dish['name']);
        $("#dish_category").text(dish['category']);
        if (dish['price'] != 0){
            $("#price").text(dish['price']);
        }
        if (dish['calorie'] != 0){
            $("#calorie").text(dish['calorie']);
        }
        if (dish['description'] != ""){
            $("#description").text(dish['description']);
        }else{
            $("#description_tag").hide();
        }
        if (dish['ingredient'] != ""){
            $("#ingredient").text(dish['ingredient']);
        }else{
            $("#ingredient_tag").hide();
        }
        $("#image").attr("src", dish['img']);
    });
    
    // Get the restaurant info
    $.get("http://192.17.90.133:8081",{request_type:'find_restaurant', RIN:params['RIN']}, function(data){
        restaurant = data[0]
        console.log(restaurant);
        $("#restaurant_name").text(restaurant['name']);
        $("#address").text(restaurant['address']);
        $("#website").attr("href", restaurant['website']);
        $("#website").text(restaurant['website']);
    });
    
    // Get top dishes of this restaurant
    $.get("http://192.17.90.133:8081",{request_type:'top_dishes', RIN:params['RIN']}, function(data){
        console.log(data);
        
        for(var i=0; i<3; i++){
            var dish = data[i];
            var dish_name = dish['name'];
            var dish_image = dish['img'];
            var dish_url_format = encodeURIComponent(dish_name);
            var file_url = window.location.href.split('?')[0];
            
            $("#top_dishes").append('<div class="col-12 col-sm-4">\
						<figure class="figure">\
                        <a href ="' + file_url+'?name='+dish_url_format+'&RIN='+params['RIN']+'">'+
							'<img src="' + dish_image +'"' +
                            'class="figure-img img-fluid rounded" alt="Image">\
                            </a>\
							<figcaption class="figure-caption">' + dish_name +
                            '</figcaption>\
						</figure>\
					</div>');
        }
    });
});
</script>
</head>
    
<body>
	<div class="container">
		<div class="row">
			<div class="col-12 col-sm-7">
				<div class="jumbotron">
					<h1 class="display-1" id = "dish_name">Dish Name</h1>
					<img id="image" src="" class="img-fluid" alt="Responsive image">
				</div>
			</div>
			<div class="col-12 col-sm-5">
				<div class="container" style="margin: 20px auto">
					<div class="row">
						<div class="col-9">
							<ul class="nav">
								<li class="nav-item">
									<a class="nav-link" href="#">Home</a>
								</li>
								<li class="nav-item">
									<a class="nav-link" href="#">History</a>
								</li>
								<li class="nav-item">
									<a class="nav-link" href="#">Log Out</a>
								</li>
							</ul>
						</div>
						<div class="col-3">
							<figure class="figure">
								<img src="if_grapes_2003194.png" class="figure-img img-fluid rounded" alt="Sumerinlan">
								<figcaption class="figure-caption">Sumerinlan</figcaption>
							</figure>
						</div>
					</div>
				</div>
				<div class="container" style="padding:0px">
					<div class="row">
						<div class="col-4">
							<p>Category</p>
						</div>
						<div class="col-8">
							<p id="dish_category">a category</p>
						</div>
					</div>
					<div class="row">
						<div class="col-4">
							<p>Price</p>
						</div>
						<div class="col-8">
							<p id="price">(No data)</p>
						</div>
					</div>
					<div class="row">
						<div class="col-4">
							<p>Calorie</p>
						</div>
						<div class="col-8">
							<p id="calorie">(No data)</p>
						</div>
					</div>
                    <div class="row" id="description_tag">
						<div class="col-4">
							<p>Description</p>
						</div>
						<div class="col-8">
							<p id="description">A simple description</p>
						</div>
					</div>
					<div class="row" id="ingredient_tag">
						<div class="col-4">
							<p>Ingredient</p>
						</div>
						<div class="col-8">
							<p id="ingredient">Some ingredient</p>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-12">
						<h2 class="display-2" id="restaurant_name">Miga Restaurant</h2>
					</div>
				</div>
				<div class="row">
					<div class="col-12 col-sm-9">
						<div class="container" style="padding:0px">
							<div class="row">
								<div class="col-3">
									<p>Address</p>
								</div>
								<div class="col-9">
									<p id="address">301 N Neil St #104, Champaign, Il 61820</p>
								</div>
							</div>
							<div class="row">
								<div class="col-3">
									<p>Website</p>
								</div>
								<div class="col-9">
									<a id="website" href="http://miga-restaurant.com/" , target="_blank">http://miga-restaurant.com/</a>
								</div>
							</div>
						</div>
					</div>
					<div class="col-12 col-sm-3">
						<p>Google Map</p>
					</div>
				</div>
				<div class="row">
					<div class="col-12">
					<p>Top Choices</p>
				</div>
				</div>
				<div class="row" id="top_dishes">
				</div>
			</div>
		</div>
	</div>
</body>

</html>
